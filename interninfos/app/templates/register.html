{% extends "base.html" %}

{% block title %}Register | ReviewSense{% endblock %}

{% block content %}
<style>
    body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(rgba(7, 4, 21, 0.7), #070415), 
            url('https://images.unsplash.com/photo-1526628953301-3e589a6a8b74?auto=format&fit=crop&w=1800&q=80') 
            no-repeat center center/cover;
        color: #c5c1d9;
        min-height: 100vh;
    }
    .register-card {
        background: linear-gradient(145deg, rgba(22, 17, 47, 0.7), rgba(15, 12, 32, 0.8));
        border-radius: 20px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(138, 43, 226, 0.3);
        padding: 2rem;
        margin-top: 4rem;
    }
    .register-image {
        width: 100px;
        margin: 0 auto 1.5rem auto;
        display: block;
    }
    .card-title {
        font-size: 1.8rem;
        color: #fff;
        text-align: center;
        margin-bottom: 1.5rem;
    }
    .form-label {
        color: #e7f4fe !important;
        font-weight: 500;
        letter-spacing: 0.5px;
    }
    /* ðŸ”¥ Add red asterisks */
    .form-label.required::after {
        content: " *";
        color: red;
        font-weight: bold;
    }
    .form-control {
        color: #18132b !important;
        background: #e7f4fe !important;
        border: 1px solid #8A2BE2 !important;
        font-weight: 500;
    }
    .btn-success {
        background: linear-gradient(90deg, #8A2BE2, #4B0082);
        border: none;
    }
    .btn-success:hover {
        background: linear-gradient(90deg, #4B0082, #8A2BE2);
    }
    .login-text {
        color: #fff;
    }
    a { color: #8A2BE2; }
</style>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="register-card">
                <img src="https://cdn-icons-png.flaticon.com/512/295/295128.png" 
                     alt="Register" class="register-image">
                <h2 class="card-title">Create Your Account</h2>

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <!-- Registration Form -->
                <form method="POST" action="{{ url_for('main.register') }}" class="needs-validation" novalidate>
                    
                    <!-- Username -->
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="username" 
                            name="username" 
                            placeholder="Choose a username" 
                            required>
                        <div class="invalid-feedback">Please enter a username.</div>
                    </div>

                    <!-- Email -->
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input 
                            type="email" 
                            class="form-control" 
                            id="email" 
                            name="email" 
                            placeholder="Enter your email" 
                            pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
                            required>
                        <div class="invalid-feedback">Please enter a valid email address.</div>
                    </div>

                    <!-- Password -->
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input 
                            type="password" 
                            class="form-control" 
                            id="password" 
                            name="password" 
                            placeholder="Create a password" 
                            pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$"
                            required>
                        <div class="invalid-feedback">
                            Password must be at least 8 characters long, 
                            include uppercase, lowercase, number, and special character.
                        </div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">Confirm Password</label>
                        <input 
                            type="password" 
                            class="form-control" 
                            id="confirm_password" 
                            name="confirm_password" 
                            placeholder="Re-enter password" 
                            required>
                        <div class="invalid-feedback">Passwords do not match.</div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-success">Register</button>
                    </div>
                </form>

                <!-- Login Link -->
                <p class="mt-3 text-center login-text">
                    Already have an account? 
                    <a href="{{ url_for('main.login') }}">Login here</a>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Auto-hide alerts
    setTimeout(() => {
        document.querySelectorAll('.alert').forEach(alert => {
            let bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 3000);

    // Add "required" class to labels of required inputs
    document.querySelectorAll('input[required], select[required], textarea[required]').forEach(input => {
        const label = document.querySelector(`label[for="${input.id}"]`);
        if (label) label.classList.add('required');
    });

    // Custom Validation
    (() => {
        'use strict';
        const form = document.querySelector('.needs-validation');
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirm_password');

        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }

            // Check password match
            if (password.value !== confirmPassword.value) {
                confirmPassword.setCustomValidity("Passwords do not match");
            } else {
                confirmPassword.setCustomValidity("");
            }

            form.classList.add('was-validated');
        }, false);

        // Live validation for password match
        confirmPassword.addEventListener('input', () => {
            if (password.value !== confirmPassword.value) {
                confirmPassword.setCustomValidity("Passwords do not match");
            } else {
                confirmPassword.setCustomValidity("");
            }
        });
    })();
</script>
{% endblock %}



